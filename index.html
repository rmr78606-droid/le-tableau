<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Le Tableau | Premium Wall Art</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
/* =========================================
   1. CORE ANIMATIONS & VARIABLES
   ========================================= */
:root { 
  --apple-ease: cubic-bezier(0.25, 1, 0.5, 1); 
  --bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
  --primary: #111;
  --secondary: #fff;
  --accent: #cba374;
  --border: #e5e5e5;
}

* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
body { background: var(--secondary); color: var(--primary); overflow-x: hidden; padding-top: 32px; }

/* Global Elements */
a, button, .btn, .cat, .card, .size, .frame-opt, .pay-method {
  transition: all 0.3s var(--apple-ease);
  cursor: pointer !important;
}

/* Page Transitions */
.page-section { display: none; padding-top: 80px; min-height: 100vh; animation: fadeUp 0.6s var(--apple-ease) forwards; }
#main-page { padding-top: 0; }

@keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

/* =========================================
   2. HEADER & NAVIGATION
   ========================================= */
.announcement-bar {
  background-color: var(--primary); color: var(--secondary); font-size: 11px; height: 32px; line-height: 32px;
  position: fixed; top: 0; left: 0; width: 100%; z-index: 2000; text-align: center;
  font-weight: 600; letter-spacing: 1px; text-transform: uppercase;
}

nav { 
  display: flex; justify-content: space-between; align-items: center;
  padding: 15px 50px; position: fixed; width: 100%; top: 32px;
  background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
  z-index: 1000; border-bottom: 1px solid rgba(0,0,0,0.05); 
}
.logo { font-family: 'Cinzel', serif; font-size: 26px; font-weight: 700; letter-spacing: 1px; cursor: pointer; }

.nav-links { display: flex; gap: 30px; }
.nav-links a { font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }

.cart-wrap { position: relative; cursor: pointer; }
.cart-badge { 
  position: absolute; top: -8px; right: -8px; background: var(--primary); color: var(--secondary); 
  font-size: 10px; font-weight: bold; height: 18px; width: 18px; 
  display: flex; justify-content: center; align-items: center; border-radius: 50%; 
  opacity: 0; transform: scale(0); transition: 0.3s var(--bounce); 
}
.cart-badge.visible { opacity: 1; transform: scale(1); }

/* =========================================
   3. MAIN SECTIONS
   ========================================= */
.hero { 
  min-height: 100vh; background: linear-gradient(rgba(0,0,0,.3),rgba(0,0,0,.3)), url("https://images.unsplash.com/photo-1582037928769-181f2422677e?q=80&w=2070&auto=format&fit=crop"); 
  background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; 
  text-align: center; color: #fff;
}
.hero h1 { font-family: 'Cinzel', serif; font-size: 56px; margin-bottom: 20px; text-shadow: 0 4px 15px rgba(0,0,0,0.3); }
.hero .btn { padding: 15px 40px; background: #fff; color: #000; border: none; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
.hero .btn:hover { background: #000; color: #fff; }

.categories { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; padding: 80px 60px; }
.cat { height: 400px; background: #eee; display: flex; justify-content: center; align-items: center; font-family: 'Cinzel'; font-size: 32px; color: #fff; position: relative; }
.cat::before { content:''; position: absolute; inset:0; background:rgba(0,0,0,0.3); }
.cat span { position: relative; z-index: 2; }
.cat.modern { background: url("https://images.unsplash.com/photo-1549887534-1541e9326642?auto=format&fit=crop&w=800") center/cover; } 
.cat.islamic { background: url("https://images.unsplash.com/photo-1584551246679-0daf3d275d0f?auto=format&fit=crop&w=800") center/cover; }

/* =========================================
   4. PRODUCT GRID & CARD
   ========================================= */
.grid { padding: 40px 60px; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 50px; }
.card { cursor: pointer; }
.card-img-wrap { width: 100%; aspect-ratio: 3/4; overflow: hidden; background: #f5f5f5; margin-bottom: 15px; position: relative; }
.card img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.6s var(--apple-ease); }
.card:hover img { transform: scale(1.05); }
.card h4 { font-weight: 600; font-size: 16px; margin-bottom: 5px; }
.price { font-size: 14px; font-weight: 700; color: #333; }

/* =========================================
   5. PRODUCT PAGE
   ========================================= */
.product-wrap { max-width: 1200px; margin: 0 auto; padding: 40px 60px; display: flex; gap: 80px; }
.product-image { flex: 1; } 
.product-image img { width: 100%; box-shadow: 0 0 0 1px #eee; }
.product-info { flex: 1; padding-top: 20px; }

.product-info h2 { font-family: 'Cinzel', serif; font-size: 42px; margin-bottom: 10px; }
.current-price { font-size: 32px; font-weight: 700; color: var(--primary); display: block; margin-bottom: 30px; }

.option-label { font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 12px; margin-top: 30px; }
.sizes, .frames { display: flex; gap: 15px; flex-wrap: wrap; }

.size, .frame-opt { 
  padding: 15px 30px; border: 1px solid #ddd; font-size: 13px; 
  text-transform: uppercase; letter-spacing: 1px; 
}
.size:hover, .frame-opt:hover { border-color: #000; }
.size.active, .frame-opt.active { background: #000; color: #fff; border-color: #000; }

.add-btn { width: 100%; padding: 20px; background: #000; color: #fff; border: none; font-weight: 700; text-transform: uppercase; margin-top: 40px; letter-spacing: 1px; }
.add-btn:hover { opacity: 0.9; }

/* =========================================
   6. CHECKOUT PAGE (DEJAVU STYLE)
   ========================================= */
.checkout-overlay { 
  position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
  background: #fff; z-index: 5000; display: none; overflow-y: auto; 
}
.checkout-overlay.active { display: block; animation: fadeUp 0.3s ease; }

.checkout-container { max-width: 1200px; margin: 0 auto; display: flex; min-height: 100vh; }
.checkout-left { flex: 1.3; padding: 60px; border-right: 1px solid #e5e5e5; }
.checkout-right { flex: 0.9; padding: 60px; background: #fafafa; }

.co-logo { font-family: 'Cinzel', serif; font-size: 28px; font-weight: 700; display: block; margin-bottom: 30px; }
.co-steps { font-size: 12px; color: #777; margin-bottom: 30px; }
.co-section-title { font-size: 18px; font-weight: 600; margin-bottom: 15px; margin-top: 30px; }

.form-group { margin-bottom: 15px; }
.form-row { display: flex; gap: 15px; }
.co-input, .co-select { 
  width: 100%; padding: 14px; border: 1px solid #d9d9d9; border-radius: 5px; 
  font-size: 14px; transition: 0.2s; 
}
.co-input:focus { border-color: #000; outline: none; box-shadow: 0 0 0 1px #000; }

.payment-box { border: 1px solid #d9d9d9; border-radius: 5px; overflow: hidden; margin-top: 20px; }
.pay-method { 
  padding: 20px; border-bottom: 1px solid #d9d9d9; display: flex; align-items: center; 
  gap: 15px; cursor: pointer; background: #fff; 
}
.pay-method:last-child { border-bottom: none; }
.pay-method.active { background: #f4fbf6; border-left: 4px solid #000; }
.radio-circle { width: 18px; height: 18px; border: 1px solid #ccc; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
.pay-method.active .radio-circle { border-color: #000; }
.pay-method.active .radio-circle::after { content: ''; width: 8px; height: 8px; background: #000; border-radius: 50%; }

.pay-btn { 
  width: 100%; padding: 22px; background: #cba374; color: #fff; font-size: 16px; 
  font-weight: 700; border: none; border-radius: 5px; margin-top: 30px; cursor: pointer; 
}
.pay-btn:hover { background: #b48b5a; }

/* Right Side Summary */
.order-item { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
.oi-img-wrap { position: relative; width: 64px; height: 64px; border: 1px solid #e5e5e5; border-radius: 8px; background: #fff; }
.oi-img { width: 100%; height: 100%; object-fit: contain; border-radius: 8px; }
.oi-badge { position: absolute; top: -8px; right: -8px; background: #666; color: #fff; font-size: 11px; width: 20px; height: 20px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: 600; }
.oi-details { flex: 1; }
.oi-name { font-size: 14px; font-weight: 600; }
.oi-variant { font-size: 12px; color: #777; }
.oi-price { font-size: 14px; font-weight: 600; }

.summary-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; color: #555; }
.total-row { display: flex; justify-content: space-between; margin-top: 25px; border-top: 1px solid #e5e5e5; padding-top: 25px; align-items: center; }
.total-label { font-size: 16px; font-weight: 500; }
.total-val { font-size: 24px; font-weight: 700; color: #000; }

/* =========================================
   7. CART DRAWER
   ========================================= */
.cart-drawer { 
  position: fixed; top: 0; right: -450px; width: 450px; height: 100%; 
  background: #fff; z-index: 4000; box-shadow: -5px 0 30px rgba(0,0,0,0.1); 
  transition: 0.4s cubic-bezier(0.25, 1, 0.5, 1); display: flex; flex-direction: column; 
}
.cart-drawer.open { right: 0; }
.cart-items { flex: 1; overflow-y: auto; padding: 25px; }
.cart-footer { padding: 25px; background: #f9f9f9; border-top: 1px solid #eee; }
.checkout-btn { width: 100%; padding: 18px; background: #000; color: #fff; font-weight: 700; border: none; }

@media(max-width:900px){
  .checkout-container { flex-direction: column-reverse; }
  .checkout-left, .checkout-right { padding: 30px; }
  .cart-drawer { width: 100%; }
}
</style>
</head>
<body>

<div class="announcement-bar">✨ FREE SHIPPING ON ORDERS OVER 2000 EGP</div>

<nav>
  <div class="logo" onclick="goHome()">Le Tableau</div>
  <div class="nav-links">
    <a onclick="openCollection('Shop All')">Shop</a>
    <a onclick="openCollection('Modern')">Modern</a>
    <a onclick="openCollection('Islamic')">Islamic</a>
  </div>
  <div class="cart-wrap" onclick="toggleCart()">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
    <span class="cart-badge" id="cartBadge">0</span>
  </div>
</nav>

<div id="main-page" class="page-section" style="display:block;">
  <div class="hero">
    <div>
      <h1>Art That Speaks</h1>
      <button class="btn" onclick="openCollection('Shop All')">Shop Collection</button>
    </div>
  </div>
  <div class="categories">
    <div class="cat modern" onclick="openCollection('Modern')"><span>Modern Art</span></div>
    <div class="cat islamic" onclick="openCollection('Islamic')"><span>Islamic Art</span></div>
  </div>
</div>

<div id="collection-page" class="page-section">
  <div style="text-align:center; padding: 60px 0 20px;">
    <h1 id="collectionTitle" style="font-family:'Cinzel'; font-size:42px;">Collection</h1>
  </div>
  <div class="grid" id="productGrid"></div>
</div>

<div id="product-page" class="page-section">
  <div class="product-wrap">
    <div class="product-image"><img id="productImage" src=""></div>
    <div class="product-info">
      <h2 id="productTitle">Artwork Name</h2>
      <p style="color:#666; line-height:1.6; margin-bottom:30px;">
        Museum-quality poster made on thick and durable matte paper. Add a wonderful accent to your room and office with these posters that are sure to brighten any environment.
      </p>

      <span class="current-price" id="dynamicPrice">0 EGP</span>

      <span class="option-label">Select Size</span>
      <div class="sizes">
        <div class="size active" onclick="selectSize(this)">30x40 CM</div>
        <div class="size" onclick="selectSize(this)">40x60 CM</div>
        <div class="size" onclick="selectSize(this)">60x90 CM</div>
      </div>

      <span class="option-label">Frame Option</span>
      <div class="frames">
        <div class="frame-opt active" onclick="selectFrame(this)">No Frame</div>
        <div class="frame-opt" onclick="selectFrame(this)">Frame</div>
      </div>

      <button id="addToCartBtn" class="add-btn">Add to Cart</button>
      
      <div style="margin-top:20px; font-size:13px; color:#2e7d32; display:flex; align-items:center; gap:8px;">
        <span style="width:8px; height:8px; background:#2e7d32; border-radius:50%; display:inline-block;"></span>
        Order Today & Get It By Feb 17
      </div>
    </div>
  </div>
</div>

<div class="cart-drawer" id="cartDrawer">
  <div style="padding:25px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
    <h3 style="font-family:'Cinzel'">Your Cart</h3>
    <span onclick="toggleCart()" style="cursor:pointer; font-size:24px;">×</span>
  </div>
  <div class="cart-items" id="cartItems"></div>
  <div class="cart-footer">
    <div style="display:flex; justify-content:space-between; margin-bottom:15px; font-weight:700;">
      <span>Subtotal</span><span id="cartSubtotal">0 EGP</span>
    </div>
    <button class="checkout-btn" onclick="openCheckout()">PROCEED TO CHECKOUT</button>
  </div>
</div>

<div id="checkoutOverlay" class="checkout-overlay">
  <div class="checkout-container">
    
    <div class="checkout-left">
      <span class="co-logo">Le Tableau</span>
      <div class="co-steps">Cart  &gt;  <span style="color:#000; font-weight:600;">Information & Payment</span></div>
      
      <div class="co-section-title">Contact Information</div>
      <div class="form-group">
        <input type="email" id="cEmail" class="co-input" placeholder="Email address">
      </div>

      <div class="co-section-title">Shipping Address</div>
      <div class="form-row">
        <div class="form-group" style="flex:1;"><input type="text" id="cFName" class="co-input" placeholder="First name"></div>
        <div class="form-group" style="flex:1;"><input type="text" id="cLName" class="co-input" placeholder="Last name"></div>
      </div>
      <div class="form-group"><input type="text" id="cAddress" class="co-input" placeholder="Address (Street, Building, Apt)"></div>
      <div class="form-row">
        <div class="form-group" style="flex:1;"><input type="text" id="cCity" class="co-input" placeholder="City"></div>
        <div class="form-group" style="flex:1;">
          <select id="cGov" class="co-select">
            <option>Cairo</option><option>Giza</option><option>Alexandria</option><option>Mansoura</option><option>Other</option>
          </select>
        </div>
      </div>
      <div class="form-group"><input type="tel" id="cPhone" class="co-input" placeholder="Phone number"></div>

      <div class="co-section-title">Payment Method</div>
      <div class="payment-box">
        <div class="pay-method active" onclick="setPayment('card', this)">
          <div class="radio-circle"></div>
          <div><strong>Pay with Card</strong> (Visa / Mastercard)</div>
          <div style="margin-left:auto; display:flex; gap:5px;">
            <img src="https://cdn-icons-png.flaticon.com/512/196/196578.png" width="24">
            <img src="https://cdn-icons-png.flaticon.com/512/196/196561.png" width="24">
          </div>
        </div>
        <div class="pay-method" onclick="setPayment('cod', this)">
          <div class="radio-circle"></div>
          <div><strong>Cash on Delivery (COD)</strong></div>
        </div>
      </div>

      <button id="payBtn" class="pay-btn" onclick="processPayment()">Pay Now</button>
      <div style="text-align:center; margin-top:20px;">
        <a onclick="document.getElementById('checkoutOverlay').classList.remove('active')" style="font-size:13px; text-decoration:underline; color:#555;">Return to Cart</a>
      </div>
    </div>

    <div class="checkout-right">
      <div id="checkoutList"></div>
      
      <div style="margin-top:30px; padding-top:20px; border-top:1px solid #e5e5e5;">
        <div class="summary-row"><span>Subtotal</span><span id="coSubtotal">0.00 EGP</span></div>
        <div class="summary-row"><span>Shipping</span><span id="coShipping">150.00 EGP</span></div>
        <div class="total-row">
          <span class="total-label">Total</span>
          <span class="total-val"><span style="font-size:14px; font-weight:400; color:#777;">EGP</span> <span id="coTotal">0.00</span></span>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
// ============================================
// 1. CONFIGURATION & SETUP
// ============================================

// بيانات Paymob (زي ما بعتها)
const PAYMOB_API_KEY = "ZXlKaGJHY2lPaUpJVXpVeE1pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SmpiR0Z6Y3lJNklrMWxjbU5vWVc1MElpd2ljSEp2Wm1sc1pWOXdheUk2TVRFek1EUXdNeXdpYm1GdFpTSTZJbWx1YVhScFlXd2lmUS5POHUyUjU0OTdJMlZKNFJTbzFVdXhoOHAtaDdHLUVULUFVcU5wSjdWdE9NOE8tcTdZUDUtS1NVS3ZXc3RmNHhVeTNrVkxVX2R3dnRSdTNsajA5V09ZZw==";
const IFRAME_ID = 1005719;
const INTEGRATION_ID = 5511043; 

// مصاريف الشحن الثابتة
const SHIPPING_COST = 150;

// جدول الأسعار (زي ما حددت بالظبط)
const prices = {
  "30x40 CM": { "No Frame": 100, "Frame": 300 },
  "40x60 CM": { "No Frame": 140, "Frame": 400 },
  "60x90 CM": { "No Frame": 200, "Frame": 550 }
};

// بيانات المنتجات (عينات)
const products = [
  { t: "Abstract Lines", i: "https://picsum.photos/600/800?1", c: "Modern" },
  { t: "Desert Vibes", i: "https://picsum.photos/600/800?2", c: "Modern" },
  { t: "Geometry I", i: "https://picsum.photos/600/800?3", c: "Modern" },
  { t: "Golden Touch", i: "https://picsum.photos/600/800?6", c: "Islamic" },
  { t: "Mountain Mist", i: "https://picsum.photos/600/800?7", c: "Islamic" },
  { t: "Calligraphy", i: "https://picsum.photos/600/800?10", c: "Islamic" }
];

let cart = [];
let selectedPaymentMethod = 'card'; // Default

// ============================================
// 2. NAVIGATION & UI LOGIC
// ============================================

function showSection(id) {
  document.querySelectorAll('.page-section').forEach(el => el.style.display = 'none');
  const target = document.getElementById(id);
  if(target) {
    target.style.display = 'block';
    window.scrollTo(0,0);
  }
}

function goHome() { showSection('main-page'); }

function openCollection(name) {
  const title = document.getElementById('collectionTitle');
  if(title) title.innerText = name;
  
  const grid = document.getElementById('productGrid');
  grid.innerHTML = "";
  
  let list = name === 'Shop All' ? products : products.filter(p => p.c === name);
  if(list.length === 0) list = products;

  list.forEach(p => {
    const card = document.createElement('div');
    card.className = "card";
    card.innerHTML = `
      <div class="card-img-wrap"><img src="${p.i}"></div>
      <h4>${p.t}</h4>
      <div class="price">From 100 EGP</div>
    `;
    card.onclick = function() { openProduct(p.t, p.i); };
    grid.appendChild(card);
  });
  showSection('collection-page');
}

// ============================================
// 3. PRODUCT PAGE & DYNAMIC PRICING
// ============================================

function openProduct(title, img) {
  document.getElementById('productTitle').innerText = title;
  document.getElementById('productImage').src = img;
  
  // Reset Selection
  const sizeBtns = document.querySelectorAll('.size');
  const frameBtns = document.querySelectorAll('.frame-opt');
  
  sizeBtns.forEach(b => b.classList.remove('active'));
  sizeBtns[0].classList.add('active'); // Default 30x40
  
  frameBtns.forEach(b => b.classList.remove('active'));
  frameBtns[0].classList.add('active'); // Default No Frame

  updatePrice(); // Calculate initial price
  showSection('product-page');
}

function selectSize(btn) {
  document.querySelectorAll('.size').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  updatePrice();
}

function selectFrame(btn) {
  document.querySelectorAll('.frame-opt').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  updatePrice();
}

function updatePrice() {
  const s = document.querySelector('.size.active').innerText.trim();
  const f = document.querySelector('.frame-opt.active').innerText.trim();
  
  let sizeKey = s;
  let frameKey = "";

  // Handle case sensitivity
  if(f.toUpperCase() === "NO FRAME") frameKey = "No Frame";
  else if(f.toUpperCase() === "FRAME") frameKey = "Frame";
  else frameKey = f;

  // Lookup Price
  if (prices[sizeKey] && prices[sizeKey][frameKey]) {
    const price = prices[sizeKey][frameKey];
    
    // Update UI
    document.getElementById('dynamicPrice').innerText = price + " EGP";
    
    // Store price in button for Add to Cart function
    const addBtn = document.getElementById('addToCartBtn');
    addBtn.setAttribute('data-price', price);
  }
}

// ============================================
// 4. CART SYSTEM
// ============================================

document.getElementById('addToCartBtn').onclick = function() {
  const t = document.getElementById('productTitle').innerText;
  const i = document.getElementById('productImage').src;
  const s = document.querySelector('.size.active').innerText;
  const f = document.querySelector('.frame-opt.active').innerText;
  
  const priceAttr = this.getAttribute('data-price');
  const p = parseInt(priceAttr);

  if(!p || isNaN(p)) return alert("Please select options again.");

  cart.push({ title: t, img: i, size: s, frame: f, price: p });
  updateCartUI();
  toggleCart();
};

function toggleCart() {
  const drawer = document.getElementById('cartDrawer');
  if(drawer.classList.contains('open')) drawer.classList.remove('open');
  else drawer.classList.add('open');
}

function updateCartUI() {
  const badge = document.getElementById('cartBadge');
  badge.innerText = cart.length;
  if(cart.length > 0) badge.classList.add('visible'); else badge.classList.remove('visible');

  const container = document.getElementById('cartItems');
  container.innerHTML = "";
  let total = 0;

  if(cart.length === 0) container.innerHTML = "<div style='text-align:center; margin-top:50px; color:#999;'>Cart is empty</div>";

  cart.forEach((item, index) => {
    total += item.price;
    container.innerHTML += `
      <div style="display:flex; gap:15px; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
        <img src="${item.img}" style="width:70px; height:90px; object-fit:cover; border-radius:4px;">
        <div style="flex:1;">
          <div style="font-weight:600; font-size:14px;">${item.title}</div>
          <div style="font-size:12px; color:#666;">${item.size} / ${item.frame}</div>
          <div style="font-weight:700;">${item.price} EGP</div>
          <div onclick="removeFromCart(${index})" style="font-size:11px; color:#c00; text-decoration:underline; cursor:pointer; margin-top:5px;">Remove</div>
        </div>
      </div>
    `;
  });

  document.getElementById('cartSubtotal').innerText = total + " EGP";
}

function removeFromCart(index) {
  cart.splice(index, 1);
  updateCartUI();
}

// ============================================
// 5. CHECKOUT & PAYMOB INTEGRATION
// ============================================

function openCheckout() {
  if(cart.length === 0) return alert("Your cart is empty");
  
  document.getElementById('cartDrawer').classList.remove('open');
  document.getElementById('checkoutOverlay').classList.add('active');
  
  renderCheckoutSummary();
}

function renderCheckoutSummary() {
  const list = document.getElementById('checkoutList');
  list.innerHTML = "";
  let subtotal = 0;

  cart.forEach(item => {
    subtotal += item.price;
    list.innerHTML += `
      <div class="order-item">
        <div class="oi-img-wrap"><img src="${item.img}" class="oi-img"><span class="oi-badge">1</span></div>
        <div class="oi-details">
          <div class="oi-name">${item.title}</div>
          <div class="oi-variant">${item.size} / ${item.frame}</div>
        </div>
        <div class="oi-price">${item.price} EGP</div>
      </div>
    `;
  });

  const total = subtotal + SHIPPING_COST; // Add 150 EGP Shipping

  document.getElementById('coSubtotal').innerText = subtotal.toFixed(2) + " EGP";
  document.getElementById('coShipping').innerText = SHIPPING_COST.toFixed(2) + " EGP";
  document.getElementById('coTotal').innerText = total.toFixed(2);
}

function setPayment(method, el) {
  selectedPaymentMethod = method;
  document.querySelectorAll('.pay-method').forEach(m => m.classList.remove('active'));
  el.classList.add('active');
  
  const btn = document.getElementById('payBtn');
  if(method === 'card') {
    btn.innerText = "Pay Now";
    btn.style.background = "#cba374";
  } else {
    btn.innerText = "Complete Order (COD)";
    btn.style.background = "#333";
  }
}

async function processPayment() {
  const btn = document.getElementById('payBtn');
  
  // Data Gathering
  const email = document.getElementById('cEmail').value;
  const fName = document.getElementById('cFName').value;
  const lName = document.getElementById('cLName').value;
  const address = document.getElementById('cAddress').value;
  const city = document.getElementById('cCity').value;
  const phone = document.getElementById('cPhone').value;

  // Validation
  if(!email || !fName || !address || !phone) {
    alert("Please fill in all contact and shipping details.");
    return;
  }

  // Handle COD
  if(selectedPaymentMethod === 'cod') {
    btn.innerText = "Processing...";
    setTimeout(() => {
      alert("Order Placed Successfully via Cash on Delivery!");
      location.reload();
    }, 1500);
    return;
  }

  // Handle Paymob
  try {
    btn.innerText = "Connecting to Bank...";
    btn.disabled = true;

    // Calculate Amount in Cents (Total * 100)
    const totalString = document.getElementById('coTotal').innerText;
    const amountCents = Math.round(parseFloat(totalString) * 100);

    // Step 1: Authentication
    let authRes = await fetch("https://accept.paymob.com/api/auth/tokens", {
      method: "POST", headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ "api_key": PAYMOB_API_KEY })
    });
    let authData = await authRes.json();
    let token = authData.token;

    // Step 2: Order Registration
    let orderRes = await fetch("https://accept.paymob.com/api/ecommerce/orders", {
      method: "POST", headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        "auth_token": token,
        "delivery_needed": "false",
        "amount_cents": amountCents,
        "currency": "EGP",
        "items": []
      })
    });
    let orderData = await orderRes.json();
    let orderId = orderData.id;

    // Step 3: Payment Key
    const billingData = {
      "apartment": "NA", "email": email, "floor": "NA", 
      "first_name": fName, "street": address, "building": "NA", 
      "phone_number": phone, "shipping_method": "NA", "postal_code": "NA", 
      "city": city || "Cairo", "country": "EG", "last_name": lName || "User", 
      "state": document.getElementById('cGov').value
    };

    let keyRes = await fetch("https://accept.paymob.com/api/acceptance/payment_keys", {
      method: "POST", headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        "auth_token": token,
        "amount_cents": amountCents,
        "expiration": 3600, 
        "order_id": orderId,
        "billing_data": billingData, 
        "currency": "EGP", 
        "integration_id": INTEGRATION_ID
      })
    });
    let keyData = await keyRes.json();
    let paymentToken = keyData.token;

    // Step 4: Redirect
    if(paymentToken) {
      window.location.href = `https://accept.paymob.com/api/acceptance/iframes/${IFRAME_ID}?payment_token=${paymentToken}`;
    } else {
      console.error(keyData);
      alert("Error initiating payment.");
      btn.disabled = false;
    }

  } catch (err) {
    console.error(err);
    alert("Connection Error.");
    btn.disabled = false;
    btn.innerText = "Pay Now";
  }
}

// Start Up
updatePrice();
</script>
</body>
</html>
