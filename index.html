<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Le Tableau | Premium Checkout</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
/* 1. CORE STYLES */
:root { --primary: #111; --secondary: #fff; --accent: #cba374; --border: #e6e6e6; }
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
body { background: var(--secondary); color: var(--primary); padding-top: 32px; overflow-x: hidden; }
a, button, .btn, .card, .payment-option { cursor: pointer !important; transition: 0.2s; }

/* 2. HEADER */
.announcement-bar { background: var(--primary); color: #fff; font-size: 11px; height: 32px; line-height: 32px; position: fixed; top: 0; width: 100%; z-index: 2000; text-align: center; font-weight: 700; letter-spacing: 1px; }
nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 50px; position: fixed; width: 100%; top: 32px; background: rgba(255,255,255,0.95); z-index: 1000; border-bottom: 1px solid var(--border); }
.logo { font-family: 'Cinzel', serif; font-size: 24px; font-weight: 700; letter-spacing: 1px; }
.nav-links a { margin: 0 15px; font-size: 12px; font-weight: 600; text-transform: uppercase; color: var(--primary); text-decoration: none; }
.cart-badge { background: var(--primary); color: #fff; font-size: 10px; padding: 2px 6px; border-radius: 50%; position: absolute; top: -5px; right: -8px; opacity: 0; }
.cart-badge.visible { opacity: 1; }

/* 3. CHECKOUT PAGE (DEJAVU STYLE) */
.page-section { display: none; padding-top: 80px; min-height: 100vh; }
#checkout-page { background: #fff; }

.checkout-container {
    display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 0; min-height: 100vh;
    border-top: 1px solid var(--border);
}

/* Left Side: Form */
.checkout-left { padding: 40px 60px; border-right: 1px solid var(--border); }
.checkout-left h2 { font-family: 'Cinzel'; margin-bottom: 30px; font-size: 22px; }
.section-title { font-size: 16px; font-weight: 600; margin-bottom: 15px; display: block; }

.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
.input-group { margin-bottom: 15px; }
.input-group label { display: block; font-size: 11px; font-weight: 600; color: #555; margin-bottom: 5px; text-transform: uppercase; }
.input-field {
    width: 100%; padding: 14px; border: 1px solid var(--border); border-radius: 5px; 
    font-size: 14px; transition: 0.3s; background: #fff;
}
.input-field:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 1px var(--primary); }

/* Payment Options Box */
.payment-box { border: 1px solid var(--border); border-radius: 5px; overflow: hidden; margin-top: 10px; }
.payment-option {
    display: flex; align-items: center; padding: 18px; border-bottom: 1px solid var(--border);
    cursor: pointer; position: relative;
}
.payment-option:last-child { border-bottom: none; }
.payment-option.active { background: #fdfdfd; }
.payment-option input { margin-right: 15px; accent-color: var(--primary); transform: scale(1.2); }
.pay-icons { position: absolute; right: 15px; display: flex; gap: 5px; }
.pay-icons img { height: 20px; }

/* Right Side: Summary */
.checkout-right { background: #fafafa; padding: 40px; position: sticky; top: 0; height: 100vh; overflow-y: auto; }
.order-summary-item { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
.item-img-wrap { width: 65px; height: 65px; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; position: relative; background: #fff; }
.item-img-wrap img { width: 100%; height: 100%; object-fit: cover; }
.item-qty { position: absolute; top: -8px; right: -8px; background: #777; color: #fff; font-size: 10px; width: 18px; height: 18px; display: flex; justify-content: center; align-items: center; border-radius: 50%; }
.item-details { flex: 1; }
.item-name { font-weight: 600; font-size: 13px; color: #333; }
.item-meta { font-size: 11px; color: #777; }
.item-price { font-weight: 600; font-size: 13px; }

.cost-line { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 10px; color: #555; }
.total-line { display: flex; justify-content: space-between; font-size: 18px; font-weight: 700; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e1e1e1; color: var(--primary); }

.pay-btn {
    width: 100%; padding: 18px; background: var(--primary); color: #fff; 
    border: none; border-radius: 5px; font-size: 14px; font-weight: 700; 
    margin-top: 25px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;
}
.pay-btn:hover { background: #333; }
.pay-btn:disabled { background: #999; cursor: not-allowed; }

/* 4. OTHER PAGES (Minimal for Context) */
#main-page, #collection-page, #product-page { padding: 40px; text-align: center; }
.grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; padding: 20px; }
.card img { width: 100%; border-radius: 4px; }

@media(max-width: 900px) { .checkout-container { grid-template-columns: 1fr; } .checkout-right { height: auto; order: -1; border-bottom: 1px solid var(--border); } }
</style>
</head>
<body>

<div class="announcement-bar">FREE SHIPPING ON ORDERS OVER 1500 EGP</div>
<nav>
  <div class="logo" onclick="goHome()">Le Tableau</div>
  <div class="nav-links">
    <a onclick="openCollection('Shop All')">Shop</a>
  </div>
  <div class="cart-wrap" id="cartIcon" onclick="goToCheckout()">
    ðŸ›’ <span class="cart-badge" id="cartBadge">0</span>
  </div>
</nav>

<div id="main-page" class="page-section" style="display:block;">
  <h1>Art That Speaks</h1>
  <button class="pay-btn" style="width:200px" onclick="openCollection('Shop All')">Start Shopping</button>
</div>

<div id="collection-page" class="page-section">
  <h1>Collection</h1>
  <div class="grid" id="productGrid"></div>
</div>

<div id="checkout-page" class="page-section" style="padding-top:32px;">
  <div class="checkout-container">
    
    <div class="checkout-left">
      <h2>Le Tableau Checkout</h2>
      
      <div class="input-group">
        <label>Contact Email</label>
        <input type="email" id="cEmail" class="input-field" placeholder="you@email.com">
      </div>

      <span class="section-title">Shipping Address</span>
      <div class="form-row">
        <div class="input-group"><label>First Name</label><input type="text" id="cFirstName" class="input-field"></div>
        <div class="input-group"><label>Last Name</label><input type="text" id="cLastName" class="input-field"></div>
      </div>
      <div class="input-group"><label>Address</label><input type="text" id="cAddress" class="input-field" placeholder="Street, Building, Apt"></div>
      <div class="form-row">
        <div class="input-group"><label>City</label><input type="text" id="cCity" class="input-field"></div>
        <div class="input-group"><label>Phone</label><input type="tel" id="cPhone" class="input-field" placeholder="01xxxxxxxxx"></div>
      </div>

      <span class="section-title" style="margin-top:30px;">Payment Method</span>
      <div class="payment-box">
        <div class="payment-option" onclick="selectPayment('CARD')">
          <input type="radio" name="payment" id="payCard" checked>
          <div><strong>Credit / Debit Card</strong><br><span style="font-size:11px; color:#666;">Secure payment via Paymob</span></div>
          <div class="pay-icons">ðŸ’³</div>
        </div>
        <div class="payment-option" onclick="selectPayment('COD')">
          <input type="radio" name="payment" id="payCOD">
          <div><strong>Cash on Delivery (COD)</strong><br><span style="font-size:11px; color:#666;">Pay when you receive</span></div>
          <div class="pay-icons">ðŸ’µ</div>
        </div>
      </div>

      <button class="pay-btn" id="payButton" onclick="processOrder()">Pay Now</button>
    </div>

    <div class="checkout-right">
      <div id="orderSummaryItems">
        </div>
      <div style="border-top:1px solid #e1e1e1; margin-top:20px; padding-top:20px;">
        <div class="cost-line"><span>Subtotal</span><span id="sumSubtotal">0.00 EGP</span></div>
        <div class="cost-line"><span>Shipping</span><span>Free</span></div>
        <div class="total-line"><span>Total</span><span id="sumTotal">0.00 EGP</span></div>
      </div>
    </div>

  </div>
</div>
<script>
// ============================================
// 1. DATA & CONFIGURATION
// ============================================
const products = [
  { t: "Abstract Lines", i: "https://picsum.photos/600/800?1", c: "Modern", p: 450 },
  { t: "Desert Vibes", i: "https://picsum.photos/600/800?2", c: "Modern", p: 450 },
  { t: "Geometry I", i: "https://picsum.photos/600/800?3", c: "Modern", p: 450 },
  { t: "Golden Touch", i: "https://picsum.photos/600/800?6", c: "Islamic", p: 550 },
  { t: "Mountain Mist", i: "https://picsum.photos/600/800?7", c: "Islamic", p: 550 },
  { t: "Urban Night", i: "https://picsum.photos/600/800?8", c: "Games", p: 450 },
  { t: "Neon City", i: "https://picsum.photos/600/800?9", c: "Games", p: 450 },
  { t: "Minimalist", i: "https://picsum.photos/600/800?12", c: "Quotes", p: 350 }
];

// Ù…ÙØ§ØªÙŠØ­ Paymob (Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©)
const PAYMOB_API_KEY = "ZXlKaGJHY2lPaUpJVXpVeE1pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SmpiR0Z6Y3lJNklrMWxjbU5vWVc1MElpd2ljSEp2Wm1sc1pWOXdheUk2TVRFek1EUXdNeXdpYm1GdFpTSTZJbWx1YVhScFlXd2lmUS5POHUyUjU0OTdJMlZKNFJTbzFVdXhoOHAtaDdHLUVULUFVcU5wSjdWdE9NOE8tcTdZUDUtS1NVS3ZXc3RmNHhVeTNrVkxVX2R3dnRSdTNsajA5V09ZZw==";
const CARD_INTEGRATION_ID = 5511043;
const IFRAME_ID = 1005719;

let cart = [];
let selectedPaymentMethod = 'CARD';
let currentCollection = 'Shop All';

// ============================================
// 2. CORE NAVIGATION
// ============================================
function showSection(id) {
  // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª
  document.querySelectorAll('.page-section').forEach(el => el.style.display = 'none');
  // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
  const target = document.getElementById(id);
  if(target) {
    target.style.display = 'block';
    target.style.animation = 'none';
    target.offsetHeight; /* trigger reflow */
    target.style.animation = 'fadeUp 0.6s var(--apple-ease) forwards';
    window.scrollTo(0, 0);
  }
}

function goHome() { showSection('main-page'); }

function openCollection(name) {
  currentCollection = name;
  const grid = document.getElementById('productGrid');
  grid.innerHTML = "";
  
  let list = (name === 'Shop All') ? products : products.filter(p => p.c === name);
  // ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ø´Ø§Ù† Ø§Ù„Ø´ÙƒÙ„ ÙŠÙ…Ù„Ø£ Ø§Ù„Ø´Ø§Ø´Ø©
  if(list.length < 8) list = list.concat(list).concat(list); 

  list.forEach(p => {
    grid.innerHTML += `
      <div class="card" onclick="addToCart('${p.t}', ${p.p}, '${p.i}')">
        <div class="card-img-wrap">
            <span class="card-badge">30% OFF</span>
            <img src="${p.i}">
            <div class="quick-add-btn">+</div>
        </div>
        <div style="padding:10px 5px;">
            <h4 style="font-size:14px; margin-bottom:5px;">${p.t}</h4>
            <div style="font-weight:700;">${p.p} EGP</div>
        </div>
      </div>`;
  });
  document.getElementById('collectionTitle').innerText = name;
  showSection('collection-page');
}

// ============================================
// 3. CART LOGIC
// ============================================
function addToCart(title, price, img) {
  cart.push({ title, price, img });
  updateCartUI();
  // Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø³ÙŠØ·
  const btn = document.querySelector('.cart-wrap');
  btn.style.transform = "scale(1.2)";
  setTimeout(()=> btn.style.transform = "scale(1)", 200);
}

function updateCartUI() {
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
  const badge = document.getElementById('cartBadge');
  badge.innerText = cart.length;
  badge.classList.add('visible');

  // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
  const container = document.getElementById('cartItemsContainer');
  let total = 0;
  
  if(cart.length === 0) {
    container.innerHTML = '<p style="text-align:center; color:#999; margin-top:50px;">Cart is empty.</p>';
  } else {
    container.innerHTML = "";
    cart.forEach((item, index) => {
      total += item.price;
      container.innerHTML += `
        <div class="cart-item">
          <img src="${item.img}">
          <div style="flex:1;">
            <div style="font-weight:600; font-size:13px;">${item.title}</div>
            <div style="font-size:12px; color:#666;">Size: 30x40 CM</div>
            <div style="font-weight:700; margin-top:5px;">${item.price} EGP</div>
          </div>
          <span class="remove-item" onclick="removeFromCart(${index})" style="color:#c00; font-size:18px;">&times;</span>
        </div>`;
    });
  }
  
  document.getElementById('cartTotal').innerText = total + " EGP";
}

function removeFromCart(index) {
  cart.splice(index, 1);
  updateCartUI();
}

function toggleCart() {
  const drawer = document.getElementById('cartDrawer');
  const overlay = document.getElementById('cartOverlay');
  
  if(drawer.classList.contains('open')) {
    drawer.classList.remove('open');
    overlay.classList.remove('active');
  } else {
    drawer.classList.add('open');
    overlay.classList.add('active');
  }
}

// ============================================
// 4. CHECKOUT PAGE LOGIC (DEJAVU STYLE)
// ============================================
function goToCheckout() {
  if(cart.length === 0) return alert("Your cart is empty!");
  toggleCart(); // Close drawer
  
  // 1. Ù…Ù„Ø¡ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨ (Ø§Ù„ÙŠÙ…ÙŠÙ†)
  const summaryList = document.getElementById('checkoutSummaryList');
  summaryList.innerHTML = "";
  let total = 0;

  cart.forEach(item => {
    total += item.price;
    summaryList.innerHTML += `
      <div class="summary-item">
        <div class="s-img-wrap">
            <img src="${item.img}">
            <span class="s-qty-badge">1</span>
        </div>
        <div class="s-details">
            <div class="s-title">${item.title}</div>
            <div class="s-meta">Standard Frame</div>
        </div>
        <div class="s-price">${item.price} EGP</div>
      </div>`;
  });

  document.getElementById('chkSubtotal').innerText = total + " EGP";
  document.getElementById('chkTotal').innerText = total + " EGP";

  // 2. Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹
  showSection('checkout-page');
}

// ØªØºÙŠÙŠØ± ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¯ÙØ¹ (Ø´ÙƒÙ„ Ø§Ù„Ø²Ø±Ø§Ø± Ø¨ÙŠØªØºÙŠØ±)
window.selectPayMethod = function(type, element) {
    selectedPaymentMethod = type;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´ÙƒÙ„ (Active Class)
    document.querySelectorAll('.payment-option').forEach(el => el.classList.remove('active'));
    element.classList.add('active');
    element.querySelector('input').checked = true;

    // ØªØºÙŠÙŠØ± Ù†Øµ Ø§Ù„Ø²Ø±Ø§Ø±
    const btn = document.getElementById('finalPayBtn');
    if(type === 'COD') {
        btn.innerText = "Complete Order";
        btn.style.background = "#444";
    } else {
        btn.innerText = "Pay Now";
        btn.style.background = "#000";
    }
}

// ============================================
// 5. PAYMOB INTEGRATION (Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ)
// ============================================
window.submitOrder = async function() {
    const btn = document.getElementById('finalPayBtn');
    
    // 1. Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙÙˆØ±Ù…
    const fname = document.getElementById('cFirstName').value;
    const lname = document.getElementById('cLastName').value;
    const phone = document.getElementById('cPhone').value;
    const address = document.getElementById('cAddress').value;
    const email = document.getElementById('cEmail').value || "guest@letableau.com"; // Default Ù„Ùˆ ÙØ§Ø¶ÙŠ

    if(!fname || !lname || !phone || !address) {
        return alert("Please fill in all Shipping Address fields.");
    }

    // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒÙ„ÙŠ
    let amountEGP = parseFloat(document.getElementById('chkTotal').innerText);
    let amountCents = amountEGP * 100;

    // 3. Ù„Ùˆ Ø§Ø®ØªØ§Ø± Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (COD)
    if(selectedPaymentMethod === 'COD') {
        btn.innerText = "Sending Order...";
        let msg = `*New Order (COD)*%0aName: ${fname} ${lname}%0aPhone: ${phone}%0aAddress: ${address}%0aTotal: ${amountEGP} EGP`;
        window.open(`https://wa.me/201000000000?text=${msg}`, '_blank');
        return;
    }

    // 4. Ù„Ùˆ Ø§Ø®ØªØ§Ø± ÙÙŠØ²Ø§ (Paymob Flow)
    try {
        let originalText = btn.innerText;
        btn.innerText = "Processing Payment...";
        btn.disabled = true;
        btn.style.background = "#666";

        // Step 1: Authentication
        let authReq = await fetch("https://accept.paymob.com/api/auth/tokens", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ "api_key": PAYMOB_API_KEY })
        });
        let authData = await authReq.json();
        let token = authData.token;

        // Step 2: Order Registration
        let orderReq = await fetch("https://accept.paymob.com/api/ecommerce/orders", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                "auth_token": token,
                "delivery_needed": "false",
                "amount_cents": amountCents,
                "currency": "EGP",
                "items": []
            })
        });
        let orderData = await orderReq.json();
        let orderId = orderData.id;

        // Step 3: Payment Key Request
        let keyReq = await fetch("https://accept.paymob.com/api/acceptance/payment_keys", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                "auth_token": token,
                "amount_cents": amountCents,
                "expiration": 3600,
                "order_id": orderId,
                "billing_data": {
                    "apartment": "NA", "email": email, "floor": "NA", 
                    "first_name": fname, "street": address, "building": "NA", 
                    "phone_number": phone, "shipping_method": "NA", 
                    "postal_code": "NA", "city": "Cairo", "country": "EG", 
                    "last_name": lname, "state": "NA"
                },
                "currency": "EGP",
                "integration_id": CARD_INTEGRATION_ID
            })
        });
        let keyData = await keyReq.json();
        let paymentToken = keyData.token;

        // Step 4: Open Iframe
        if(paymentToken) {
            window.location.href = `https://accept.paymob.com/api/acceptance/iframes/${IFRAME_ID}?payment_token=${paymentToken}`;
        } else {
            alert("Error connecting to bank.");
            btn.innerText = originalText;
            btn.disabled = false;
            btn.style.background = "#000";
        }

    } catch (err) {
        console.error(err);
        alert("Connection Failed. Check internet.");
        btn.disabled = false;
        btn.innerText = "Pay Now";
        btn.style.background = "#000";
    }
};

// ============================================
// 6. INITIALIZATION
// ============================================
window.onload = function() {
    // Show Popup after 2 seconds
    setTimeout(() => {
        document.getElementById('welcomePopup').classList.add('active');
    }, 2000);
};
</script>
</body>
</html>
