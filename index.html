<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Le Tableau | Premium Wall Art</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
/* 1. ESSENTIALS & VARIABLES */
:root { --primary: #111; --secondary: #fff; --accent: #cba374; --border: #e6e6e6; --bg-grey: #fafafa; --apple-ease: cubic-bezier(0.25, 1, 0.5, 1); }
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
body { background: var(--secondary); color: var(--primary); overflow-x: hidden; padding-top: 32px; }

/* FIX CURSORS */
a, button, .btn, .cat, .card, .size, .frame-opt, .nav-link, .logo, .cart-wrap, .close-icon, .payment-option {
  transition: all 0.3s var(--apple-ease);
  cursor: pointer !important;
}

/* ANIMATIONS */
.page-section, .text-page { display: none; padding-top: 100px; min-height: 100vh; animation: fadeUp 0.6s var(--apple-ease) forwards; }
#main-page { padding-top: 0; display: block; }
@keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
@keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

/* 2. HEADER */
.announcement-bar { background: var(--primary); color: var(--secondary); font-size: 11px; height: 32px; line-height: 32px; position: fixed; top: 0; width: 100%; z-index: 2000; overflow: hidden; white-space: nowrap; font-weight: 700; letter-spacing: 1px; }
.announcement-content { display: inline-block; animation: marquee 25s linear infinite; padding-left: 100%; }

nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 50px; position: fixed; width: 100%; top: 32px; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); z-index: 1000; border-bottom: 1px solid rgba(0,0,0,0.05); }
.logo { font-family: 'Cinzel', serif; font-size: 26px; font-weight: 700; letter-spacing: 1px; }
.nav-links { display: flex; gap: 25px; }
.nav-links a { font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; position: relative; padding: 5px 0; }
.nav-links a::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0%; height: 2px; background: var(--primary); transition: 0.3s; }
.nav-links a:hover::after { width: 100%; }
.cart-wrap { position: relative; display: flex; align-items: center; }
.cart-badge { position: absolute; top: -6px; right: -6px; background: var(--primary); color: var(--secondary); font-size: 10px; font-weight: bold; height: 16px; width: 16px; display: flex; justify-content: center; align-items: center; border-radius: 50%; }

/* 3. HERO & GRID */
.hero { min-height: 100vh; background: linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2)), url("hero.jpg") center/cover; display: flex; align-items: center; justify-content: center; text-align: center; }
.hero-content { color: #fff; max-width: 800px; padding: 20px; animation: fadeUp 1s forwards; }
.hero h1 { font-family: 'Cinzel', serif; font-size: 56px; margin-bottom: 20px; text-shadow: 0 4px 15px rgba(0,0,0,0.3); }
.btn { padding: 16px 45px; background: var(--secondary); color: var(--primary); font-weight: 700; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; border: 1px solid var(--secondary); }
.btn:hover { background: transparent; color: var(--secondary); transform: translateY(-3px); }

.categories { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; padding: 80px 60px; }
.cat { height: 350px; background: #f5f5f5; display: flex; justify-content: center; align-items: center; font-size: 26px; font-family: 'Cinzel', serif; position: relative; overflow: hidden; color: #fff; border-radius: 4px; }
.cat::before { content: ""; position: absolute; inset: 0; background: rgba(0,0,0,0.25); transition: 0.5s; }
.cat:hover::before { background: rgba(0,0,0,0.45); }
.cat.modern { background: url("modern.jpg") center/cover; } .cat.islamic { background: url("islamic.jpg") center/cover; }
.cat.games { background: url("games.jpg") center/cover; } .cat.quotes { background: url("post.jpg") center/cover; }

/* 4. CHECKOUT PAGE STYLES (DEJAVU STYLE) */
.checkout-split { display: flex; flex-wrap: wrap; min-height: 100vh; background: #fff; }
.checkout-left { flex: 1.2; padding: 50px 8%; border-right: 1px solid var(--border); }
.checkout-right { flex: 0.8; padding: 50px 6%; background: var(--bg-grey); border-left: 1px solid var(--border); }
.co-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
.co-title { font-size: 18px; font-weight: 600; margin: 25px 0 15px; }
.form-row { display: flex; gap: 15px; margin-bottom: 12px; }
.input-group { flex: 1; }
.input-field { width: 100%; padding: 14px; border: 1px solid #d9d9d9; border-radius: 5px; font-size: 14px; transition: 0.3s; }
.input-field:focus { border-color: #000; outline: none; box-shadow: 0 0 0 1px #000; }

/* Payment Box */
.payment-box { border: 1px solid var(--border); border-radius: 5px; overflow: hidden; margin-top: 20px; }
.payment-option { padding: 18px; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid var(--border); cursor: pointer; background: #fff; }
.payment-option:last-child { border-bottom: none; }
.payment-option.active { background: #f4faff; border-left: 4px solid #111; }
.radio-circle { width: 18px; height: 18px; border: 2px solid #ccc; border-radius: 50%; position: relative; }
.payment-option.active .radio-circle { border-color: #111; }
.payment-option.active .radio-circle::after { content: ''; width: 10px; height: 10px; background: #111; border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); }

/* Order Summary Items */
.summary-item { display: flex; gap: 15px; align-items: center; margin-bottom: 15px; }
.sum-img-wrap { position: relative; width: 65px; height: 65px; }
.sum-img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; border: 1px solid rgba(0,0,0,0.1); }
.sum-qty { position: absolute; top: -8px; right: -8px; background: #777; color: #fff; width: 20px; height: 20px; border-radius: 50%; font-size: 11px; display: flex; justify-content: center; align-items: center; }
.sum-details { flex: 1; }
.sum-price { font-weight: 600; }
.total-line { display: flex; justify-content: space-between; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e6e6e6; font-size: 19px; font-weight: 700; }

.pay-btn-lg { width: 100%; padding: 20px; background: #111; color: #fff; font-weight: 700; border: none; border-radius: 5px; font-size: 16px; margin-top: 25px; cursor: pointer; }
.pay-btn-lg:hover { opacity: 0.9; }

/* 5. PRODUCT & POPUPS */
.grid { padding: 0 60px 60px; display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 40px; }
.card { cursor: pointer; } .card img { width: 100%; aspect-ratio: 3/4; object-fit: cover; }
.cart-drawer { position: fixed; top: 0; right: -450px; width: 450px; height: 100%; background: #fff; z-index: 3001; transition: 0.5s cubic-bezier(0.25, 1, 0.5, 1); display: flex; flex-direction: column; box-shadow: -10px 0 30px rgba(0,0,0,0.1); }
.cart-drawer.open { right: 0; }
.overlay-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 3000; display: none; }
.overlay-bg.active { display: block; }

/* Welcome Popup */
.promo-modal { background: #fff; padding: 50px 40px; text-align: center; max-width: 450px; position: relative; border-radius: 8px; animation: popIn 0.5s; top: 50%; left: 50%; transform: translate(-50%, -50%); }
.close-icon { position: absolute; top: 15px; right: 15px; font-size: 24px; border: none; background: none; color: #999; }

@media(max-width:900px){
  .checkout-split { flex-direction: column-reverse; }
  .checkout-right { padding: 20px; border-bottom: 1px solid #eee; }
  .checkout-left { padding: 20px; }
  nav { padding: 15px 20px; } .nav-links { display: none; } .cart-drawer { width: 100%; }
}
</style>
</head>
<body>

<div class="announcement-bar"><div class="announcement-content">✨ FREE SHIPPING ON ORDERS OVER 1500 EGP &nbsp; • &nbsp; USE CODE: <strong>FRIST10</strong> FOR 10% OFF</div></div>

<div class="overlay-bg active" id="welcomePopup">
  <div class="promo-modal">
    <button class="close-icon" onclick="document.getElementById('welcomePopup').classList.remove('active')">✕</button>
    <h2 style="font-family:'Cinzel',serif; margin-bottom:15px;">Welcome Gift</h2>
    <p style="color:#666;">Join the Le Tableau family and get 10% off.</p>
    <div style="background:#f5f5f5; border:1px dashed #000; padding:15px; font-size:24px; font-weight:700; margin:20px 0; color:#cba374;">Frist10</div>
    <p style="font-size:12px; color:#555; margin-bottom:20px; border-top:1px solid #eee; padding-top:10px;">Want <strong>15% OFF</strong>? Subscribe to our newsletter below!</p>
    <button class="btn" style="background:#000; color:#fff; width:100%;" onclick="document.getElementById('welcomePopup').classList.remove('active')">Start Shopping</button>
  </div>
</div>

<div class="overlay-bg" id="cartOverlay" onclick="toggleCart()"></div>
<div class="cart-drawer" id="cartDrawer">
  <div style="padding:25px; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
    <h3 style="font-family:'Cinzel',serif;">Shopping Cart</h3><button onclick="toggleCart()" style="background:none; border:none; font-size:24px;">✕</button>
  </div>
  <div id="cartItemsContainer" style="flex:1; overflow-y:auto; padding:25px;">
    <p style="text-align:center; color:#999; margin-top:50px;">Your cart is empty.</p>
  </div>
  <div style="padding:25px; background:#f9f9f9;">
    <div style="display:flex; justify-content:space-between; margin-bottom:15px; font-weight:700;"><span>Total</span><span id="cartTotal">0 EGP</span></div>
    <button class="btn" style="width:100%; background:#000; color:#fff;" onclick="goToCheckout()">CHECKOUT SECURELY</button>
  </div>
</div>

<nav>
  <div class="logo" onclick="showSection('main-page')">Le Tableau</div>
  <div class="nav-links">
    <a onclick="openCollection('Shop All')">Shop All</a>
    <a onclick="openCollection('Modern')">Modern</a>
    <a onclick="openCollection('Islamic')">Islamic</a>
    <a onclick="openCollection('Games')">Gaming</a>
  </div>
  <div class="cart-wrap" onclick="toggleCart()">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line></svg>
    <span class="cart-badge" id="cartBadge">0</span>
  </div>
</nav>

<div id="main-page" class="page-section">
  <div class="hero"><div class="hero-content"><h1>Art That Speaks</h1><p>Curated premium wall art.</p><button class="btn" onclick="openCollection('Shop All')">Explore Now</button></div></div>
  <section><div class="categories"><div class="cat modern" onclick="openCollection('Modern')"><span>Modern</span></div><div class="cat islamic" onclick="openCollection('Islamic')"><span>Islamic</span></div><div class="cat games" onclick="openCollection('Games')"><span>Gaming</span></div><div class="cat quotes" onclick="openCollection('Quotes')"><span>Quotes</span></div></div></section>
</div>

<div id="collection-page" class="page-section">
  <div style="padding:40px; text-align:center;"><h1 id="collectionTitle" style="font-family:'Cinzel',serif;">Collection</h1></div>
  <div class="grid" id="productGrid"></div>
</div>

<div id="product-page" class="page-section">
  <div class="product-wrap">
    <div class="product-image"><img id="productImage" src=""></div>
    <div class="product-info">
      <a class="back-btn" onclick="openCollection('Shop All')">← Back</a>
      <h2 id="productTitle" style="font-family:'Cinzel',serif; margin:15px 0;">Art Name</h2>
      <div style="font-size:24px; font-weight:700; margin-bottom:20px;">450 EGP</div>
      <button class="btn" style="width:100%; background:#000; color:#fff;" id="addToCartBtn">ADD TO CART</button>
    </div>
  </div>
</div>

<div id="privacy-page" class="text-page"><h1>Privacy Policy</h1><p>Content...</p></div>
<div id="refund-page" class="text-page"><h1>Refund Policy</h1><p>Content...</p></div>
<div id="shipping-page" class="text-page"><h1>Shipping Policy</h1><p>Content...</p></div>
<div id="checkout-page" class="page-section" style="background:#fff; padding-top:0; z-index:2000; position:fixed; top:0; left:0; width:100%; height:100%; overflow-y:auto;">
  <div class="checkout-split">
    
    <div class="checkout-left">
      <div class="co-header">
        <h2 style="font-family:'Cinzel',serif; font-size:28px;">Le Tableau.</h2>
        <a onclick="showSection('main-page')" style="text-decoration:underline; font-size:13px; color:#555;">Return to Store</a>
      </div>

      <div class="co-title">Contact Information</div>
      <div class="input-group" style="margin-bottom:15px;">
        <input type="email" id="cEmail" class="input-field" placeholder="Email Address (for order confirmation)">
      </div>

      <div class="co-title">Shipping Address</div>
      <div class="form-row">
        <div class="input-group"><input type="text" id="cName" class="input-field" placeholder="First Name"></div>
        <div class="input-group"><input type="text" id="cLastName" class="input-field" placeholder="Last Name"></div>
      </div>
      <div class="input-group" style="margin-bottom:12px;"><input type="text" id="cAddress" class="input-field" placeholder="Address (Street, Building, Apartment)"></div>
      <div class="form-row">
        <div class="input-group"><input type="text" id="cCity" class="input-field" placeholder="City"></div>
        <div class="input-group"><input type="text" id="cGov" class="input-field" placeholder="Governorate"></div>
      </div>
      <div class="input-group"><input type="tel" id="cPhone" class="input-field" placeholder="Phone Number (Required)"></div>

      <div class="co-title">Payment Method</div>
      <div class="payment-box">
        <div class="payment-option active" onclick="selectPayment('card', this)">
          <div class="radio-circle"></div>
          <span style="font-weight:600; font-size:14px; margin-left:10px; flex:1;">Pay via Card / Wallet</span>
          <div style="display:flex; gap:5px;">
            <span style="font-size:10px; background:#eee; padding:2px 5px; border-radius:3px; color:#555;">VISA</span>
            <span style="font-size:10px; background:#eee; padding:2px 5px; border-radius:3px; color:#555;">Mastercard</span>
          </div>
        </div>
        <div class="payment-option" onclick="selectPayment('cod', this)">
          <div class="radio-circle"></div>
          <span style="font-weight:600; font-size:14px; margin-left:10px;">Cash on Delivery (COD)</span>
        </div>
      </div>

      <button id="payButton" class="pay-btn-lg" onclick="processOrder()">PAY NOW</button>
      <p style="text-align:center; font-size:11px; color:#888; margin-top:15px;">All transactions are secure and encrypted.</p>
    </div>

    <div class="checkout-right">
      <div id="orderSummaryList">
        </div>
      
      <div style="border-top:1px solid #e6e6e6; margin-top:25px; padding-top:20px;">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:14px; color:#555;">
          <span>Subtotal</span><span id="summarySubtotal">0.00 EGP</span>
        </div>
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:14px; color:#555;">
          <span>Shipping</span><span>Free</span>
        </div>
        <div class="total-line">
          <span>Total</span>
          <span id="summaryTotal">0.00 EGP</span>
        </div>
      </div>
    </div>

  </div>
</div>

<div class="overlay-bg" id="sizeModal" onclick="document.getElementById('sizeModal').style.display='none'">
  <div class="modal-content" onclick="event.stopPropagation()" style="background:#fff; width:90%; max-width:500px; margin:100px auto; padding:20px; border-radius:8px; position:relative;">
    <button onclick="document.getElementById('sizeModal').style.display='none'" style="position:absolute; right:15px; top:15px; background:none; border:none; font-size:24px;">✕</button>
    <h3 style="margin-bottom:20px; font-family:'Cinzel',serif;">Size Guide</h3>
    <div style="width:100%; aspect-ratio:4/3; background:#eee; margin-bottom:20px; display:flex; align-items:center; justify-content:center;">Room Preview Placeholder</div>
    <div style="display:flex; gap:10px; justify-content:center;">
      <button class="size active">30x40</button><button class="size">40x60</button><button class="size">50x70</button>
    </div>
  </div>
</div>

<footer>
  <div class="footer-wrapper">
    <div class="footer-left">
      <span class="footer-logo">Le Tableau.</span>
      <p style="font-size:13px; color:#666; margin:15px 0;">Subscribe to our emails.</p>
      <div class="newsletter-form">
        <input type="email" class="newsletter-input" placeholder="Email">
        <button class="newsletter-btn" onclick="alert('Subscribed! Check for Sham15 code.')">→</button>
      </div>
    </div>
    <div class="footer-right">
      <div class="footer-menu"><h4>Shop</h4><ul><li><a onclick="openCollection('Shop All')">All Art</a></li><li><a onclick="openCollection('Modern')">Modern</a></li></ul></div>
      <div class="footer-menu"><h4>Help</h4><ul><li><a onclick="showSection('shipping-page')">Shipping</a></li><li><a onclick="showSection('refund-page')">Returns</a></li></ul></div>
    </div>
  </div>
  <div class="footer-bottom"><div class="currency">EGP £</div><div class="copyright">© 2026 Le Tableau</div></div>
</footer>

<script>
// 1. DATA
const products = [
  { t: "Abstract Lines", p: 450, i: "https://picsum.photos/400?1", c: "Modern" },
  { t: "Desert Vibes", p: 550, i: "https://picsum.photos/400?2", c: "Modern" },
  { t: "Geometry I", p: 480, i: "https://picsum.photos/400?3", c: "Modern" },
  { t: "Ocean Blue", p: 500, i: "https://picsum.photos/400?4", c: "Modern" },
  { t: "Golden Touch", p: 600, i: "https://picsum.photos/400?5", c: "Islamic" },
  { t: "Mountain Mist", p: 520, i: "https://picsum.photos/400?6", c: "Islamic" },
  { t: "Urban Night", p: 480, i: "https://picsum.photos/400?7", c: "Games" },
  { t: "Neon City", p: 450, i: "https://picsum.photos/400?8", c: "Games" }
];

let cart = [];
let paymentMethod = 'card'; // Default

// 2. NAVIGATION
function showSection(id) {
  document.querySelectorAll('.page-section, .text-page').forEach(el => el.style.display = 'none');
  document.getElementById(id).style.display = 'block';
  window.scrollTo(0,0);
}

function openCollection(name) {
  const grid = document.getElementById('productGrid');
  document.getElementById('collectionTitle').innerText = name;
  grid.innerHTML = '';
  
  let list = (name === 'Shop All') ? products : products.filter(p => p.c === name);
  
  list.forEach(p => {
    grid.innerHTML += `
      <div class="card" onclick="addToCart('${p.t}', ${p.p}, '${p.i}')">
        <div style="position:relative;">
          <img src="${p.i}">
          <div style="position:absolute; bottom:10px; right:10px; background:#fff; width:35px; height:35px; border-radius:50%; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 10px rgba(0,0,0,0.1);">+</div>
        </div>
        <div style="padding:10px 0;">
          <h4 style="font-size:14px; margin-bottom:5px;">${p.t}</h4>
          <div style="font-weight:700; font-size:14px;">${p.p} EGP</div>
        </div>
      </div>
    `;
  });
  showSection('collection-page');
}

// 3. CART LOGIC
function addToCart(title, price, img) {
  cart.push({ title, price, img });
  updateCartDrawer();
  toggleCart(); // Show cart when added
}

function updateCartDrawer() {
  document.querySelector('.cart-badge').innerText = cart.length;
  const container = document.getElementById('cartItemsContainer');
  let total = 0;
  
  if(cart.length === 0) {
    container.innerHTML = '<p style="text-align:center; color:#999; margin-top:30px;">Cart is empty.</p>';
  } else {
    container.innerHTML = '';
    cart.forEach((item, idx) => {
      total += item.price;
      container.innerHTML += `
        <div style="display:flex; gap:15px; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
          <img src="${item.img}" style="width:60px; height:60px; object-fit:cover; border-radius:4px;">
          <div style="flex:1;">
            <div style="font-size:13px; font-weight:600;">${item.title}</div>
            <div style="font-size:12px; color:#555;">${item.price} EGP</div>
            <div style="font-size:11px; color:#c00; margin-top:5px; cursor:pointer;" onclick="cart.splice(${idx},1); updateCartDrawer()">Remove</div>
          </div>
        </div>
      `;
    });
  }
  document.getElementById('cartTotal').innerText = total + " EGP";
}

function toggleCart() {
  const drawer = document.getElementById('cartDrawer');
  const overlay = document.getElementById('cartOverlay');
  if(drawer.classList.contains('open')) {
    drawer.classList.remove('open');
    overlay.classList.remove('active');
  } else {
    drawer.classList.add('open');
    overlay.classList.add('active');
  }
}

// 4. CHECKOUT LOGIC (NEW)
function goToCheckout() {
  if(cart.length === 0) return alert("Your cart is empty!");
  toggleCart(); // Close drawer
  showSection('checkout-page'); // Open new page
  
  // Fill Summary
  const sumList = document.getElementById('orderSummaryList');
  sumList.innerHTML = '';
  let total = 0;
  
  cart.forEach(item => {
    total += item.price;
    sumList.innerHTML += `
      <div class="summary-item">
        <div class="sum-img-wrap">
          <img src="${item.img}" class="sum-img">
          <div class="sum-qty">1</div>
        </div>
        <div class="sum-details">
          <div style="font-size:14px; font-weight:600;">${item.title}</div>
          <div style="font-size:12px; color:#777;">Standard Frame</div>
        </div>
        <div class="sum-price">${item.price} EGP</div>
      </div>
    `;
  });
  
  document.getElementById('summarySubtotal').innerText = total + " EGP";
  document.getElementById('summaryTotal').innerText = total + " EGP";
}

function selectPayment(type, el) {
  paymentMethod = type;
  document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('active'));
  el.classList.add('active');
  
  const btn = document.getElementById('payButton');
  if(type === 'cod') btn.innerText = "COMPLETE ORDER";
  else btn.innerText = "PAY NOW";
}

// 5. PAYMENT PROCESSING (REAL)
const PAYMOB_API = "ZXlKaGJHY2lPaUpJVXpVeE1pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SmpiR0Z6Y3lJNklrMWxjbU5vWVc1MElpd2ljSEp2Wm1sc1pWOXdheUk2TVRFek1EUXdNeXdpYm1GdFpTSTZJbWx1YVhScFlXd2lmUS5POHUyUjU0OTdJMlZKNFJTbzFVdXhoOHAtaDdHLUVULUFVcU5wSjdWdE9NOE8tcTdZUDUtS1NVS3ZXc3RmNHhVeTNrVkxVX2R3dnRSdTNsajA5V09ZZw==";
const CARD_INTEGRATION_ID = 5511043;
const IFRAME_ID = 1005719;

async function processOrder() {
  const btn = document.getElementById('payButton');
  const name = document.getElementById('cName').value;
  const phone = document.getElementById('cPhone').value;
  const address = document.getElementById('cAddress').value;
  const totalText = document.getElementById('summaryTotal').innerText;
  
  // Validation
  if(!name || !phone || !address) return alert("Please fill in shipping details.");

  // Option A: COD
  if(paymentMethod === 'cod') {
    let msg = `New Order! Name: ${name}, Phone: ${phone}, Address: ${address}, Total: ${totalText}`;
    window.open(`https://wa.me/201000000000?text=${encodeURIComponent(msg)}`, '_blank');
    return;
  }

  // Option B: CARD (Paymob)
  let amount = parseFloat(totalText) * 100; // Cents
  try {
    btn.innerText = "Processing...";
    btn.disabled = true;

    // 1. Auth
    let auth = await fetch("https://accept.paymob.com/api/auth/tokens", {
      method: "POST", headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ "api_key": PAYMOB_API })
    }).then(r => r.json());

    // 2. Order
    let order = await fetch("https://accept.paymob.com/api/ecommerce/orders", {
      method: "POST", headers: {"Content-Type":"application/json"},
      body: JSON.stringify({
        "auth_token": auth.token,
        "delivery_needed": "false",
        "amount_cents": amount,
        "currency": "EGP",
        "items": []
      })
    }).then(r => r.json());

    // 3. Key
    let key = await fetch("https://accept.paymob.com/api/acceptance/payment_keys", {
      method: "POST", headers: {"Content-Type":"application/json"},
      body: JSON.stringify({
        "auth_token": auth.token,
        "amount_cents": amount,
        "expiration": 3600,
        "order_id": order.id,
        "billing_data": {
          "apartment": "NA", "email": "user@test.com", "floor": "NA",
          "first_name": name, "street": address, "building": "NA",
          "phone_number": phone, "shipping_method": "NA",
          "postal_code": "NA", "city": "Cairo", "country": "EG",
          "last_name": "Customer", "state": "NA"
        },
        "currency": "EGP",
        "integration_id": CARD_INTEGRATION_ID
      })
    }).then(r => r.json());

    // 4. Redirect
    if(key.token) {
      window.location.href = `https://accept.paymob.com/api/acceptance/iframes/${IFRAME_ID}?payment_token=${key.token}`;
    } else {
      alert("Error initiating payment.");
      btn.innerText = "Try Again";
      btn.disabled = false;
    }

  } catch (e) {
    console.error(e);
    alert("Connection error.");
    btn.innerText = "Try Again";
    btn.disabled = false;
  }
}

// Initial Load
openCollection('Shop All');
</script>
</body>
</html>
